import * as React from "react"
import Head from 'next/head'
import styles from '../styles/Home.module.css'

import { transformSync } from "@swc/core"

export async function getStaticProps() {
  const arbitraryString = "function Foo() { console.log('test'); return <h3>test</h3> }"
  const { code } = transformSync(arbitraryString, {
    minify: false,
    jsc: {
      minify: {
        compress: {
          unused: false,
        },
        mangle: false,
      },
      parser: {
        jsx: true,
        syntax: "ecmascript",
      },
      transform: null,
      target: "es2020",
    },
  })

  return {
    revalidate: 60,
    props: {
      code
    }
  }
}

const makeComponent = (code) => new Function("React", `return ${code}`)(React)

export default function Home({ code }) {
  const MyComponent = makeComponent(code)

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <h1 className={styles.title}>
          Welcome to <a href="https://nextjs.org">Next.js!</a>
        </h1>
        <MyComponent />
      </main>
    </div>
  )
}
